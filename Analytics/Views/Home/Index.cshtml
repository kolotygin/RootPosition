@using Infrastructure.Extensions
@using Web.Mvc.Html
@using Web.Mvc.Models

@{
    Layout = "~/Views/Shared/_Layout.cshtml";

    Html.Resources().Styles.Add(Url.Content("~/CSS/root.linegraph.css"));
    Html.Resources().Styles.Add(Url.Content("~/CSS/root.analytics.css"));

    Html.Resources().Scripts.Add(Url.Content("~/Scripts/jquery.min.js"));
    Html.Resources().Scripts.Add(Url.Content("~/Scripts/knockout.js"));
    Html.Resources().Scripts.Add(Url.Content("~/Scripts/root.extensions.js"));
    Html.Resources().Scripts.Add(Url.Content("~/Scripts/jquery.extensions.js"));
    Html.Resources().Scripts.Add(Url.Content("~/Scripts/root.DataStructures.js"));
    Html.Resources().Scripts.Add(Url.Content("~/Scripts/root.WebResourceUrl.js"));
    Html.Resources().Scripts.Add(Url.Content("~/Scripts/D3/d3.v3.min.js"));
    Html.Resources().Scripts.Add(Url.Content("~/Scripts/D3/topojson.v1.min.js"));
    Html.Resources().Scripts.Add(Url.Content("~/Scripts/root.LineGraph.js"));
    Html.Resources().Scripts.Add(Url.Content("~/Scripts/root.Analytics.ChoroplethMap.js"));
    Html.Resources().Scripts.Add(Url.Content("~/Scripts/root.Analytics.Controller.js"));
    Html.Resources().Scripts.Add(Url.Content("~/Scripts/root.Analytics.ViewModel.js"));
}

@section Body {

<div id="AnalyticsViewContainer" runat="server" class="an-view">
    <div class="an-header">
        <div class="an-header-actions">
            <ul class="an-header-actions-options">
                <li>
                    <a href="javascript:void(0);" class="an-header-actions-options-email"></a>
                </li>
                <li>
                    <a href="javascript:void(0);" class="an-header-actions-options-print"></a>
                </li>
            </ul>
        </div>
        <div class="an-header-date-range">
            <dnn:DnnDatePicker ID="StartDatePicker" runat="server" resourcekey="StartDatePicker" data-bind="dnnDatePicker: startDate"/>
            <label class="an-header-to-label"><%= LocalizeString("DateRangeTo") %></label>
            <dnn:DnnDatePicker ID="EndDatePicker" runat="server" resourcekey="EndDatePicker" data-bind="dnnDatePicker: endDate"/>
        </div>
    </div>

    <div class="an-timeline-view" data-bind="with: timeLineView">
        <div class="an-timeline-view-header">
            <select class="an-metric-options" data-bind="options: $parent.metricTypes, optionsText: 'value', value: $parent.selectedMetricType">
            </select>
            <ul class="an-timeline-view-scale-options">
                <li>
                    <a href="javascript:void(0);" data-bind="css: { selected: isDayScale }, click: setScale, attr: { data: scales.Day }"><%=LocalizeString("ScaleDay")%></a>
                </li>
                <li>
                    <a href="javascript:void(0);" data-bind="css: { selected: isWeekScale }, click: setScale, attr: { data: scales.Week }"><%=LocalizeString("ScaleWeek")%></a>
                </li>
                <li>
                    <a href="javascript:void(0);" data-bind="css: { selected: isMonthScale }, click: setScale, attr: { data: scales.Month }"><%=LocalizeString("ScaleMonth")%></a>
                </li>
                <li>
                    <a href="javascript:void(0);" data-bind="css: { selected: isYearScale }, click: setScale, attr: { data: scales.Year }"><%=LocalizeString("ScaleYear")%></a>
                </li>
            </ul>
        </div>
        <div id="TimeLineViewChartContainer" runat="server" class="an-timeline-view-chart"></div>
    </div>

    <div class="an-metric-view" data-bind="with: metricView">
        <table class="an-metric-view-values fixed">
            <colgroup>
                <col class="an-metric-view-value-col"/>
                <col class="an-metric-view-value-col"/>
                <col class="an-metric-view-value-col"/>
                <col class="an-metric-view-value-col"/>
                <col class="an-metric-view-value-col"/>
                <col class="an-metric-view-value-col"/>
            </colgroup>
            <thead>
                <tr>
                    <th scope="col"><%= LocalizeString("PageviewsColumnHeader") %></th>
                    <th scope="col"><%= LocalizeString("UniquePageviewsColumnHeader") %></th>
                    <th scope="col"><%= LocalizeString("AverageTimeColumnHeader") %></th>
                    <th scope="col"><%= LocalizeString("EntrancesColumnHeader") %></th>
                    <th scope="col"><%= LocalizeString("BounceRateColumnHeader") %></th>
                    <th scope="col"><%= LocalizeString("ExitRateColumnHeader") %></th>
                </tr>
            </thead>
            <tbody>
                <tr data-bind="with: values()">
                    <td class="an-metric-view-cell-pageviews" data-bind="text: pageViews"></td>
                    <td class="an-metric-view-cell-unique-pageviews" data-bind="text: uniquePageViews"></td>
                    <td class="an-metric-view-cell-average-time" data-bind="text: averageTime"></td>
                    <td class="an-metric-view-cell-entrances" data-bind="text: entrances"></td>
                    <td class="an-metric-view-cell-bounce-rate" data-bind="text: bounceRate"></td>
                    <td class="an-metric-view-cell-exit-rate" data-bind="text: exitRate"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="an-geomap-view">
        <label class="an-view-header"><%= LocalizeString("GeographySectionHeader") %></label>
        <div id="GeoMapViewChartContainer" runat="server">
            <div id="GeoMapZoom" runat="server" class="an-geomap-view-zoom">
                <div class="an-geomap-view-zoom-handle"></div>
            </div>
        </div>
    </div>

    <div class="an-sources-view" data-bind="with: sourcesView">
        <label class="an-view-header"><%= LocalizeString("SourcesSectionHeader") %></label>

        <div class="an-sources-view-tabs">
            <ul>
                <!-- ko foreach: categories -->
                <li data-bind="css: { selected: $parent.isSelected($data) }">
                    <a href="javascript:void(0);" data-bind="text: key, click: function () { $parent.selectCategory($data); }"></a>
                </li>
                <!-- /ko -->
            </ul>
        </div>

        <div class="an-sources-view-categories">

            <div class="an-sources-view-pie-chart">
                <div id="SourcesViewPieChartContainer" runat="server"></div>
            </div>

            <div class="an-sources-view-selected-category">
                <div class="an-sources-view-selected-category-details" data-bind="with: selectedCategory">
                    <div>
                        <ul data-bind="with: value">
                            <li>
                                <label><%= LocalizeString("AvgTimeOnPageSourcesDetailsLabel") %></label>
                                <span data-bind="text: averageTime"></span>
                            </li>
                            <li>
                                <label><%= LocalizeString("EntrancesSourcesDetailsLabel") %></label>
                                <span data-bind="text: entrances"></span>
                            </li>
                            <li>
                                <label><%= LocalizeString("BounceRateSourcesDetailsLabel") %></label>
                                <span data-bind="text: bounceRate + '%'"></span>
                            </li>
                            <li>
                                <label><%= LocalizeString("ExitRateSourcesDetailsLabel") %></label>
                                <span data-bind="text: exitRate + '%'"></span>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="an-sources-view-selected-category-description">
                    <div>
                        <!-- ko with: metric -->
                        <label class="an-sources-view-selected-category-description-title" data-bind="text: key"></label>
                        <!-- /ko -->
                        <!-- ko with: selectedCategory -->
                        <span class="an-sources-view-selected-category-description-value" data-bind="text: value.pageViews"></span>
                        <!-- /ko -->
                        <span class="an-sources-view-selected-category-description-note"><%= LocalizeString("SelectedSourceCategoryDescriptionLabel") %></span>
                        <span class="an-sources-view-selected-category-description-note" data-bind="text: selectedCategoryDescription"></span>
                    </div>
                </div>
            </div>

        </div>

    </div>

</div>

}

@section Scripts {
<script type="text/javascript">
    root.Analytics.initialize("#AnalyticsViewContainer", @Html.Raw(Model.ToJson()));
</script>
}
